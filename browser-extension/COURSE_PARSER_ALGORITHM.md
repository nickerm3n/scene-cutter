# Алгоритм парсинга курса

## Обзор
Алгоритм автоматически извлекает данные из курса Udemy, включая заголовки секций, элементы курса, URL видео и транскрипты.

## Пошаговый алгоритм

### 1. Инициализация
- Клик по кнопке "Course content" для открытия аккордеона
- Пауза 1 секунда для загрузки контента

### 2. Поиск контейнера секций
- Поиск элемента с атрибутом `data-purpose="curriculum-section-container"`
- Извлечение всех секций с атрибутом `data-purpose^="section-panel-"`

### 3. Обработка секций
Для каждой секции:
- Извлечение заголовка секции через `.ud-accordion-panel-title`
- Клик по секции для раскрытия аккордеона
- Пауза 4 секунды для загрузки элементов

### 4. Обработка элементов
Для каждого элемента в секции:
- Извлечение заголовка элемента через `[data-purpose="item-title"]`
- Клик по элементу для перехода к видео
- Пауза 2 секунды для загрузки страницы

### 5. Извлечение видео
- Поиск видео элемента через различные селекторы:
  - `video.video-player--video-player--HiAnq`
  - `video[controlslist="nodownload"]`
  - `video source`
  - `video`
- Извлечение URL из атрибута `src`

### 6. Извлечение транскрипта
- Проверка наличия открытой панели транскрипта
- Если панель не открыта - клик по кнопке `[data-purpose="transcript-toggle"]`
- Ожидание появления панели транскрипта
- Извлечение текста из элементов `[data-purpose="cue-text"]`

### 7. Возврат к списку секций
- Клик по кнопке "Course content" для возврата к аккордеону
- Пауза 4 секунды для загрузки

### 8. Сохранение данных
- Сохранение всех извлеченных данных в структурированном виде
- Обновление UI с результатами

## Структура данных

```javascript
{
  title: "Название курса",
  url: "URL курса",
  extractedAt: "2024-01-01T00:00:00.000Z",
  sections: [
    {
      title: "Название секции",
      items: [
        {
          title: "Название элемента",
          videoUrl: "URL видео",
          transcript: "Текст транскрипта",
          dataPurpose: "идентификатор элемента"
        }
      ]
    }
  ]
}
```

## Особенности реализации

### Обработка ошибок
- Каждая секция и элемент обрабатываются в try-catch блоках
- При ошибке обработка продолжается со следующим элементом
- Подробное логирование всех ошибок

### Ожидание элементов
- Функция `waitForElement()` для ожидания появления элементов
- Настраиваемые таймауты для разных типов элементов
- Автоматическое продолжение при отсутствии элемента

### Безопасные клики
- Функция `safeClick()` для проверки видимости элемента
- Автоматическая прокрутка к элементу
- Проверка размеров элемента перед кликом

### Отслеживание прогресса
- Отправка сообщений о прогрессе в UI
- Отображение текущей секции и элемента
- Обновление статуса выполнения

## Конфигурация

### Селекторы
Все селекторы определены в `config.js`:
- `TRANSCRIPT_BUTTON`: кнопка транскрипта
- `TRANSCRIPT_PANEL`: панель транскрипта
- `CUE_TEXT`: текст транскрипта
- `SECTION_PANELS`: секции курса
- `ITEM_TITLE`: заголовки элементов

### Задержки
Настраиваемые задержки в `config.js`:
- `TRANSCRIPT_LOAD`: загрузка транскрипта (2000ms)
- `COURSE_CONTENT_LOAD`: загрузка контента курса (2000ms)
- `ITEM_PROCESS`: обработка элемента (3000ms)
- `SECTION_EXPAND`: раскрытие секции (1000ms)

## Использование

```javascript
// Запуск парсинга курса
import { handleCourse } from './courseExtractor.js';

// Обработка результата
handleCourse().then(result => {
  console.log('Парсинг завершен:', result);
}).catch(error => {
  console.error('Ошибка парсинга:', error);
});
```
