# Миграция на новую архитектуру

## Что изменилось

Большой файл `popup.js` (1440 строк) был разделен на 8 логических модулей:

### Старая структура:
```
popup.js (1440 строк)
├── Глобальные переменные
├── DOM элементы
├── Обработчики событий
├── Извлечение ссылок
├── Извлечение транскриптов
├── Извлечение курса
├── UI функции
├── Утилиты
└── Работа с хранилищем
```

### Новая структура:
```
config.js (конфигурация)
utils.js (утилиты)
storage.js (хранилище)
ui.js (пользовательский интерфейс)
linkExtractor.js (извлечение ссылок)
transcriptExtractor.js (извлечение транскриптов)
courseExtractor.js (извлечение курса)
popup-new.js (основной файл)
```

## Шаги миграции

### 1. Создание новых файлов
Все новые модули уже созданы в папке `browser-extension/`:
- `config.js`
- `utils.js`
- `storage.js`
- `ui.js`
- `linkExtractor.js`
- `transcriptExtractor.js`
- `courseExtractor.js`
- `popup-new.js`

### 2. Обновление HTML
В файле `popup.html` замените:
```html
<script src="popup.js"></script>
```
на:
```html
<script type="module" src="popup-new.js"></script>
```

### 3. Тестирование
1. Откройте расширение в Chrome
2. Проверьте все функции:
   - Извлечение ссылок
   - Извлечение транскрипта
   - Извлечение курса
   - Обработка элементов
   - Настройки

### 4. Удаление старого файла (опционально)
После успешного тестирования можно удалить старый `popup.js`:
```bash
rm browser-extension/popup.js
```

## Преимущества новой архитектуры

### До миграции:
- ❌ Один большой файл (1440 строк)
- ❌ Смешанная ответственность
- ❌ Сложно найти нужную функцию
- ❌ Трудно тестировать
- ❌ Сложно поддерживать

### После миграции:
- ✅ 8 логических модулей
- ✅ Единственная ответственность
- ✅ Легко найти нужную функцию
- ✅ Можно тестировать модули независимо
- ✅ Легко поддерживать и расширять

## Возможные проблемы и решения

### 1. Ошибки импорта модулей
**Проблема:** `Uncaught TypeError: Failed to resolve module specifier`
**Решение:** Убедитесь, что в `popup.html` указан `type="module"`

### 2. Ошибки CORS
**Проблема:** `CORS policy: The request client is not a secure context`
**Решение:** Расширения Chrome работают в безопасном контексте, модули должны работать корректно

### 3. Функции не найдены
**Проблема:** `Uncaught ReferenceError: function is not defined`
**Решение:** Проверьте, что все функции экспортированы и импортированы правильно

### 4. Проблемы с состоянием
**Проблема:** Состояние не синхронизируется между модулями
**Решение:** Используйте `config.js` для глобального состояния

## Откат изменений

Если что-то пошло не так, можно легко вернуться к старой версии:

1. В `popup.html` замените:
```html
<script type="module" src="popup-new.js"></script>
```
на:
```html
<script src="popup.js"></script>
```

2. Удалите новые модули (если нужно):
```bash
rm browser-extension/config.js
rm browser-extension/utils.js
rm browser-extension/storage.js
rm browser-extension/ui.js
rm browser-extension/linkExtractor.js
rm browser-extension/transcriptExtractor.js
rm browser-extension/courseExtractor.js
rm browser-extension/popup-new.js
```

## Дальнейшее развитие

После успешной миграции можно:

1. **Добавить тесты** для каждого модуля
2. **Создать TypeScript версию** для лучшей типизации
3. **Добавить документацию** для каждого модуля
4. **Реализовать новые функции** в отдельных модулях
5. **Оптимизировать производительность** каждого модуля независимо

## Поддержка

Если возникли проблемы с миграцией:

1. Проверьте консоль браузера на ошибки
2. Убедитесь, что все файлы находятся в правильных местах
3. Проверьте синтаксис ES6 модулей
4. Обратитесь к документации в `ARCHITECTURE.md`
