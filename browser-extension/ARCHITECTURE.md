# Архитектура Course Parser Extension

## Обзор

Расширение было рефакторено в соответствии с принципами чистого кода и модульной архитектуры. Код разделен на логические модули, каждый из которых отвечает за определенную функциональность.

## Структура модулей

### 1. `config.js` - Конфигурация и настройки
**Ответственность:** Управление конфигурацией приложения, настройками и DOM элементами.

**Основные компоненты:**
- `CONFIG` - константы конфигурации (селекторы, задержки, URL)
- `currentSettings` - текущие настройки пользователя
- `DOM_ELEMENTS` - ссылки на DOM элементы
- `extractedLinks` - глобальное состояние извлеченных ссылок

**Функции:**
- `loadSettings()` - загрузка настроек из Chrome Storage
- `saveSettings()` - сохранение настроек
- `updateSettingsUI()` - обновление UI настроек

### 2. `utils.js` - Утилиты и вспомогательные функции
**Ответственность:** Общие утилиты для работы с Chrome API, UI, данными.

**Основные функции:**
- `getCurrentTab()` - получение активной вкладки
- `executeScriptOnPage()` - выполнение скриптов на странице
- `setStatus()` - установка статуса в UI
- `copyToClipboard()` - копирование в буфер обмена
- `delay()` - утилита для задержек
- `log()`, `logError()` - логирование

### 3. `storage.js` - Работа с данными
**Ответственность:** Управление localStorage, экспорт/импорт данных.

**Основные функции:**
- `saveCourseToStorage()` - сохранение курса
- `loadCourseFromStorage()` - загрузка курса
- `saveItemTranscript()` - сохранение транскрипта элемента
- `exportCourseData()` - экспорт данных курса
- `clearCourseData()` - очистка данных
- `getStorageStats()` - статистика хранилища

### 4. `ui.js` - Пользовательский интерфейс
**Ответственность:** Управление отображением данных и обработчиками событий.

**Основные функции:**
- `updateLinksList()` - обновление списка ссылок
- `updateTranscriptDisplay()` - обновление отображения транскрипта
- `updateCourseDisplay()` - обновление отображения курса
- `setupEventListeners()` - настройка обработчиков событий
- `removeLink()` - удаление ссылки

### 5. `linkExtractor.js` - Извлечение ссылок
**Ответственность:** Извлечение ссылок со страницы и отправка на сервер.

**Основные функции:**
- `handleExtract()` - обработка извлечения ссылок
- `handleSend()` - обработка отправки на сервер
- `extractLinksFromPage()` - функция для выполнения на странице

### 6. `transcriptExtractor.js` - Извлечение транскриптов
**Ответственность:** Извлечение транскриптов видео и обработка элементов курса.

**Основные функции:**
- `handleTranscript()` - извлечение транскрипта
- `handleProcessItem()` - обработка элемента курса
- `clickTranscriptButton()` - клик по кнопке транскрипта
- `extractTranscriptText()` - извлечение текста транскрипта

### 7. `courseExtractor.js` - Извлечение структуры курса
**Ответственность:** Извлечение полной структуры курса с секциями и элементами.

**Основные функции:**
- `handleCourse()` - обработка извлечения курса
- `clickCourseContentButton()` - клик по кнопке Course content
- `extractAccordionSections()` - извлечение секций аккордеона

### 8. `popup-new.js` - Основной файл
**Ответственность:** Точка входа приложения, инициализация.

**Основные функции:**
- `initializeApp()` - инициализация приложения

## Принципы архитектуры

### 1. Единственная ответственность (Single Responsibility)
Каждый модуль отвечает только за одну область функциональности.

### 2. Разделение ответственности (Separation of Concerns)
- Конфигурация отделена от логики
- UI отделен от бизнес-логики
- Хранение данных отделено от обработки

### 3. Инверсия зависимостей (Dependency Inversion)
Модули зависят от абстракций (интерфейсов), а не от конкретных реализаций.

### 4. Открытость/Закрытость (Open/Closed)
Модули открыты для расширения, но закрыты для модификации.

## Преимущества новой архитектуры

1. **Читаемость:** Код легче читать и понимать
2. **Поддерживаемость:** Легче вносить изменения и исправлять ошибки
3. **Тестируемость:** Модули можно тестировать независимо
4. **Переиспользование:** Функции можно использовать в разных контекстах
5. **Масштабируемость:** Легко добавлять новую функциональность

## Миграция

Для перехода на новую архитектуру:

1. Замените `popup.js` на `popup-new.js` в `popup.html`
2. Убедитесь, что все модули находятся в правильных местах
3. Проверьте работу всех функций

## Советы по разработке

1. **Добавление новой функциональности:** Создайте новый модуль или добавьте функцию в существующий
2. **Изменение конфигурации:** Редактируйте только `config.js`
3. **Отладка:** Используйте функции `log()` и `logError()` для логирования
4. **Тестирование:** Тестируйте модули независимо друг от друга
